# npm 登录和发布说明

## 问题说明

你当前使用的是淘宝镜像源 `https://registry.npmmirror.com/`，这个镜像源**不支持注册和发布**，只能用于下载包。

## 解决方案

项目已配置 `.npmrc` 文件，`@pengmeng` 作用域包会自动使用 npm 官方仓库。

### 方法一：登录时指定官方仓库（推荐）

直接在登录命令中指定使用官方仓库：

```bash
npm login --registry=https://registry.npmjs.org/
```

或者使用 pnpm：

```bash
pnpm login --registry=https://registry.npmjs.org/
```

登录时会提示输入：
- Username（用户名）
- Password（密码）
- Email（邮箱）

### 方法二：临时切换全局 registry

如果你想临时切换全局 registry 来登录：

```bash
# 切换到官方仓库
npm config set registry https://registry.npmjs.org/

# 登录
npm login

# 登录完成后，可以切换回镜像（可选，用于加速安装）
npm config set registry https://registry.npmmirror.com/
```

**注意**：即使全局使用镜像，项目中的 `.npmrc` 文件会确保 `@pengmeng` 作用域包使用官方仓库。

## 验证登录

登录成功后，验证：

```bash
npm whoami --registry=https://registry.npmjs.org/
```

应该会显示你的 npm 用户名。

## 发布流程

1. **登录 npm**（使用上面的方法）

2. **构建项目**
   ```bash
   pnpm run build
   ```

3. **发布包**
   ```bash
   # 先发布工具库
   pnpm run publish:utils
   
   # 再发布组件库
   pnpm run publish:components
   ```

## 配置说明

项目中的 `.npmrc` 文件已配置：
- 默认 registry：`https://registry.npmmirror.com/`（用于安装依赖，速度快）
- `@pengmeng` 作用域：`https://registry.npmjs.org/`（用于发布）

这样配置的好处：
- ✅ 安装依赖时使用镜像，速度快
- ✅ 发布时自动使用官方仓库
- ✅ 不需要手动切换 registry

## 常见问题

### Q: 登录时还是提示 "Public registration is not allowed"

A: 确保登录命令中指定了官方仓库：
```bash
npm login --registry=https://registry.npmjs.org/
```

### Q: 如何查看当前使用的 registry？

A: 
```bash
# 查看全局配置
npm config get registry

# 查看项目配置（会读取 .npmrc）
npm config get registry --location=project
```

### Q: 发布时如何确保使用官方仓库？

A: 项目中的 `package.json` 已配置 `publishConfig.registry`，发布时会自动使用官方仓库。你也可以在发布命令中指定：
```bash
pnpm publish --registry=https://registry.npmjs.org/
```

