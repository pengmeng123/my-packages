/**
 * è‡ªåŠ¨ç”Ÿæˆç»„ä»¶åº“å…¥å£æ–‡ä»¶
 * æ‰«æ src/components ç›®å½•ï¼Œç”Ÿæˆ src/index.ts
 */

const fs = require('fs');
const path = require('path');

const COMPONENTS_DIR = path.resolve(__dirname, '../src/components');
const OUTPUT_FILE = path.resolve(__dirname, '../src/index.ts');

/**
 * è·å–æ‰€æœ‰ç»„ä»¶ç›®å½•å
 */
function getComponentNames() {
  const entries = fs.readdirSync(COMPONENTS_DIR, { withFileTypes: true });
  return entries
    .filter((entry) => entry.isDirectory())
    .map((entry) => entry.name)
    .sort();
}

/**
 * ç”Ÿæˆå…¥å£æ–‡ä»¶å†…å®¹
 */
function generateEntryContent(componentNames) {
  const imports = componentNames
    .map((name) => `import ${name} from './components/${name}';`)
    .join('\n');

  const componentsList = componentNames.join(', ');
  const exports = componentNames.join(', ');

  return `// Auto-generated by scripts/generate-entry.js
// å…¨å±€æ ·å¼
import './styles/index.less';

// ç»„ä»¶å¯¼å…¥
${imports}

// ç»„ä»¶åˆ—è¡¨
const components = [${componentsList}];

// Vue.use() å…¨é‡å®‰è£…
function install(Vue: any): void {
  components.forEach((component) => {
    Vue.use(component);
  });
}

// å¯¼å‡ºç»„ä»¶
export { ${exports} };

// å¯¼å‡ºé»˜è®¤å®‰è£…æ–¹æ³•
export default {
  install,
};
`;
}

/**
 * ä¸»å‡½æ•°
 */
function main() {
  console.log('ğŸ” æ‰«æç»„ä»¶ç›®å½•...');
  const componentNames = getComponentNames();

  if (componentNames.length === 0) {
    console.log('âš ï¸  æœªæ‰¾åˆ°ä»»ä½•ç»„ä»¶');
    return;
  }

  console.log(`ğŸ“¦ æ‰¾åˆ° ${componentNames.length} ä¸ªç»„ä»¶:`);
  componentNames.forEach((name) => console.log(`   - ${name}`));

  const content = generateEntryContent(componentNames);
  fs.writeFileSync(OUTPUT_FILE, content, 'utf-8');

  console.log(`âœ… å…¥å£æ–‡ä»¶å·²ç”Ÿæˆ: ${OUTPUT_FILE}`);
}

main();

